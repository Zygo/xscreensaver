<!doctypehtml><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1"name=viewport><title>HexTrail - XScreenSaver Web Version</title><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#1e3c72 0,#2a5298 100%);color:#fff;min-height:100vh;display:flex;align-items:center;justify-content:center;overflow-y:auto;overflow-x:hidden}#container{max-width:1200px;width:100%;padding:20px;position:relative}#header{text-align:center;margin-bottom:30px}#header h1{font-size:3rem;margin-bottom:10px;text-shadow:2px 2px 4px rgba(0,0,0,.5);background:linear-gradient(45deg,#ff6b6b,#4ecdc4,#45b7d1);background-size:200% 200%;-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:gradient 3s ease infinite}@keyframes gradient{0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}#header p{font-size:1.2rem;opacity:.9}#canvas-container{position:relative;display:flex;justify-content:center;margin-bottom:30px}#canvas{border:2px solid rgba(255,255,255,.2);border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.3);background:#000;max-width:100%;height:auto;display:block}#loading{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:1.5rem;color:#4ecdc4;text-shadow:0 0 10px rgba(78,205,196,.5);animation:pulse 2s ease-in-out infinite}@keyframes pulse{0%,100%{opacity:.6}50%{opacity:1}}#controls{background:rgba(255,255,255,.1);backdrop-filter:blur(10px);border-radius:15px;padding:15px;margin-bottom:20px;display:flex;flex-wrap:wrap;gap:10px;align-items:flex-start;border:1px solid rgba(255,255,255,.2)}.control-group{display:flex;flex-direction:column;gap:8px}.control-group label{font-weight:600;color:#4ecdc4}.control-group input[type=range]{width:80%;height:6px;border-radius:3px;background:rgba(255,255,255,.2);outline:0;-webkit-appearance:none}.control-group input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;border-radius:50%;background:#4ecdc4;cursor:pointer;box-shadow:0 2px 6px rgba(0,0,0,.3)}.control-group input[type=range]::-moz-range-thumb{width:20px;height:20px;border-radius:50%;background:#4ecdc4;cursor:pointer;border:none;box-shadow:0 2px 6px rgba(0,0,0,.3)}.control-group input[type=checkbox]{width:18px;height:18px;accent-color:#4ecdc4}.control-group span{font-size:.9rem;opacity:.8}.control-group:has(button){flex-direction:row;justify-content:center;gap:10px;padding:0 20px}.control-group:has(button) button{min-width:120px}button{background:linear-gradient(45deg,#4ecdc4,#45b7d1);color:#fff;border:none;padding:12px 24px;border-radius:8px;cursor:pointer;font-weight:600;transition:all .3s ease;box-shadow:0 4px 15px rgba(0,0,0,.2)}button:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,.3)}button:active{transform:translateY(0)}#info{background:rgba(255,255,255,.1);backdrop-filter:blur(10px);border-radius:10px;padding:15px;text-align:center;border:1px solid rgba(255,255,255,.2)}#info p{margin:5px 0;font-size:.9rem;opacity:.9}#debug-panel{position:fixed;top:50px;right:10px;width:400px;height:300px;background:rgba(0,0,0,.8);color:#fff;font-family:monospace;font-size:12px;padding:10px;border:1px solid #333;overflow-y:auto;z-index:1000;display:none;resize:horizontal}#debug-panel::before{content:'';position:absolute;left:0;top:0;bottom:0;width:8px;background:0 0;cursor:ew-resize;z-index:1002}#debug-panel::after{content:'';position:absolute;left:0;top:0;bottom:0;width:1px;background:rgba(128,128,128,.3);z-index:1002}#debug-panel>div:first-child{position:sticky;top:0;background:rgba(0,0,0,.8);z-index:1001;padding-bottom:5px}#debug-log{word-wrap:break-word;white-space:pre-wrap}.debug-stdout{color:#4ecdc4}.debug-stderr{color:#ff6b6b;font-weight:700}#debug-toggle{position:fixed;top:10px;right:10px;background:rgba(0,0,0,.8);color:#fff;border:1px solid #333;padding:5px 10px;cursor:pointer;z-index:1000;font-family:monospace;font-size:12px}#canvas:fullscreen{width:100vw;height:100vh;border:none;border-radius:0;max-width:none}#canvas:-webkit-full-screen{width:100vw;height:100vh;border:none;border-radius:0;max-width:none}#canvas:-moz-full-screen{width:100vw;height:100vh;border:none;border-radius:0;max-width:none}@media (max-width:768px){#container{padding:10px}#header h1{font-size:2rem}#controls{grid-template-columns:1fr;gap:15px}#canvas{max-width:100%;height:auto}}</style></head><body><div id=container><div id=header><h1>HexTrail</h1><p>A mesmerizing hexagonal cellular automaton from XScreenSaver</p></div><div id=canvas-container><canvas height=600 id=canvas width=800></canvas><div id=loading>Loading HexTrail...</div></div><div id=controls><div class=control-group><label for=speed>Speed:</label> <input id=speed type=range max=3.0 min=0.1 step=0.1 value=1.0> <span id=speed-value>1.0</span></div><div class=control-group><label for=thickness>Thickness:</label> <input id=thickness type=range max=0.5 min=0.05 step=0.01 value=0.15> <span id=thickness-value>0.15</span></div><div class=control-group><label><input id=spin type=checkbox checked> Spin</label> <label><input id=wander type=checkbox checked> Wander</label></div><div class=control-group><button id=reset>Reset</button> <button id=render-toggle>Stop Rendering</button> <button id=debug-toggle-btn>Disable Debug</button> <button id=fullscreen>Fullscreen</button></div></div><div id=info><p>Click and drag to rotate the view. Use mouse wheel to zoom.</p><p>Press 'F' for fullscreen, 'R' to reset, 'S' to toggle spin, 'W' to toggle wander.</p><p><strong>Debug Panel:</strong> Captures both stdout (teal) and stderr (red) from the WebAssembly module!</p></div><div id=debug-panel><div style=display:flex;justify-content:space-between;align-items:center;margin-bottom:10px><div><h3 style=margin:0>Debug Output</h3><small style=color:#888;font-size:.8em><span style=color:#4ecdc4>●</span> stdout | <span style=color:#ff6b6b>●</span> stderr</small></div><div><button onclick='document.getElementById("debug-panel").style.display="none",document.getElementById("debug-toggle").style.display="block"'style="background:#333;color:#fff;border:1px solid #666;padding:2px 8px;cursor:pointer">×</button></div></div><div id=debug-log></div></div><button id=debug-toggle onclick='document.getElementById("debug-panel").style.display="block",this.style.display="none"'>Debug</button><div id=memory-display style="position:fixed;top:10px;right:10px;background:rgba(0,0,0,.8);color:#fff;padding:5px 10px;border-radius:5px;font-family:monospace;font-size:12px;z-index:1000;display:none">Memory: --MB / --MB</div></div><script>console.log("DEBUG: Script starting...");var globalDebugEnabled=!0;function setGlobalDebugEnabled(e){globalDebugEnabled=e,console.log("Global debug "+(e?"enabled":"disabled"));var t=document.getElementById("debug-toggle-btn");t&&(t.textContent=e?"Disable Debug":"Enable Debug")}function testStderrOutput(e){addDebugLog("C code stderr test: "+e,"stderr")}window.setGlobalDebugEnabled=setGlobalDebugEnabled,window.testStderrOutput=testStderrOutput;var debugPaused=!1;function toggleDebugPause(){debugPaused=!debugPaused,document.getElementById("debug-pause-btn").textContent=debugPaused?"Resume":"Pause"}function smartScrollToBottom(e){if(e){var t=e.scrollHeight-e.scrollTop-e.clientHeight,n=t<5;console.log("Scroll debug:",{scrollHeight:e.scrollHeight,scrollTop:e.scrollTop,clientHeight:e.clientHeight,scrollDiff:t,isAtBottom:n}),n?(e.scrollTop=e.scrollHeight,console.log("Auto-scrolling to bottom")):console.log("Not auto-scrolling - user scrolled up")}}function addDebugLog(e,t){if(!debugPaused){var n=document.getElementById("debug-panel"),o=document.getElementById("debug-log");if(n&&o){var l=n.scrollHeight-n.scrollTop-n.clientHeight<5,d=new Date,s=d.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})+"."+d.getMilliseconds().toString().padStart(3,"0"),u="";"stderr"===t?u="debug-stderr":"stdout"===t&&(u="debug-stdout");var r=u?'<span class="'+u+'">'+e+"</span>":e;o.innerHTML+="["+s+"] "+r+"<br>",l&&requestAnimationFrame((function(){n.scrollTop=n.scrollHeight}))}else console.log("DEBUG: No debug panel or log element found!")}}window.onerror=function(e,t,n,o,l){addDebugLog("ERROR: "+e+" at "+t+":"+n,"stderr")};var memoryMonitorInterval,Module={canvas:document.getElementById("canvas"),setStatus:function(e){var t=document.getElementById("loading");t&&(t.textContent=e),addDebugLog("Status: "+e,"stdout")},print:function(...e){globalDebugEnabled&&addDebugLog(e.join(" "),"stdout")},printErr:function(...e){addDebugLog(e.join(" "),"stderr")},onRuntimeInitialized:function(){console.log("Module runtime initialized");var e=document.getElementById("loading");e&&(e.style.display="none"),addDebugLog("Module runtime initialized","stdout"),setupControls(),setupFullscreenHandling(),setTimeout((function(){var e=document.getElementById("spin"),t=document.getElementById("wander"),n=document.getElementById("speed"),o=document.getElementById("thickness");Module._set_spin&&Module._set_wander&&Module._set_speed&&Module._set_thickness&&(Module._set_spin(e.checked?1:0),Module._set_wander(t.checked?1:0),Module._set_speed(parseFloat(n.value)),Module._set_thickness(parseFloat(o.value)),console.log("DEBUG: Initialized all controls - spin="+e.checked+", wander="+t.checked+", speed="+n.value+", thickness="+o.value))}),100)}},memoryMonitoringEnabled=!1;function enableMemoryMonitoring(){memoryMonitoringEnabled=!0;var e=document.getElementById("memory-display");e&&(e.style.display="block"),startMemoryMonitoring()}function startMemoryMonitoring(){memoryMonitoringEnabled&&(memoryMonitorInterval&&clearInterval(memoryMonitorInterval),memoryMonitorInterval=setInterval((function(){try{if(Module&&Module.HEAPU8){var e=Module.HEAPU8.length,t=e;Module._emscripten_get_heap_size&&(t=Module._emscripten_get_heap_size());var n=(t/1048576).toFixed(2),o=(e/1048576).toFixed(2);(l=document.getElementById("memory-display"))&&(l.textContent=`Memory: ${n}MB / ${o}MB`),window.lastMemoryUsage&&t>1.1*window.lastMemoryUsage&&addDebugLog(`WARNING: Memory usage increased by ${((t-window.lastMemoryUsage)/1048576).toFixed(2)}MB`,"stderr"),window.lastMemoryUsage=t}else{(l=document.getElementById("memory-display"))&&(l.textContent="Memory: Monitoring unavailable")}}catch(e){var l;console.log("Memory monitoring error:",e),(l=document.getElementById("memory-display"))&&(l.textContent="Memory: Error")}}),1e3))}function setupControls(){var e=document.getElementById("speed"),t=document.getElementById("speed-value");e.addEventListener("input",(function(){var e=this.value;t.textContent=e,Module._set_speed&&Module._set_speed(parseFloat(e))}));var n=document.getElementById("thickness"),o=document.getElementById("thickness-value");n.addEventListener("input",(function(){var e=this.value;o.textContent=e,Module._set_thickness&&Module._set_thickness(parseFloat(e))}));var l=document.getElementById("spin");l.addEventListener("change",(function(){Module._set_spin&&Module._set_spin(this.checked?1:0)}));var d=document.getElementById("wander");d.addEventListener("change",(function(){Module._set_wander&&Module._set_wander(this.checked?1:0)}));var s=document.getElementById("reset");s.addEventListener("click",(function(){e.value=1,t.textContent="1.0",n.value=.15,o.textContent="0.15",l.checked=!0,d.checked=!0,Module._set_speed&&Module._set_speed(1),Module._set_thickness&&Module._set_thickness(.15),Module._set_spin&&Module._set_spin(1),Module._set_wander&&Module._set_wander(1)}));var u=document.getElementById("render-toggle"),r=!0;u.addEventListener("click",(function(){r?(Module._stop_rendering&&(Module._stop_rendering(),console.log("Rendering stopped")),u.textContent="Start Rendering",r=!1):(Module._start_rendering&&(Module._start_rendering(),console.log("Rendering started")),u.textContent="Stop Rendering",r=!0)}));var a=document.getElementById("debug-toggle-btn"),i=!0;a.addEventListener("click",(function(){i?(Module._set_global_debug_enabled&&(Module._set_global_debug_enabled(0),console.log("Debug disabled")),a.textContent="Enable Debug",i=!1):(Module._set_global_debug_enabled&&(Module._set_global_debug_enabled(1),console.log("Debug enabled")),a.textContent="Disable Debug",i=!0)})),setInterval((function(){i!==globalDebugEnabled&&(i=globalDebugEnabled,console.log("Synced debug state: "+(i?"enabled":"disabled")))}),100);var c=document.getElementById("canvas"),g=!1,m=0,b=0;c.addEventListener("mousedown",(function(e){g=!0,m=e.clientX,b=e.clientY})),c.addEventListener("mousemove",(function(e){if(g&&Module._handle_mouse_drag){var t=e.clientX-m,n=e.clientY-b;Module._handle_mouse_drag(t,n),m=e.clientX,b=e.clientY}})),c.addEventListener("mouseup",(function(){g=!1})),c.addEventListener("wheel",(function(e){e.preventDefault(),Module._handle_mouse_wheel&&Module._handle_mouse_wheel(e.deltaY>0?1:-1)}),{passive:!1}),document.addEventListener("keydown",(function(e){switch(e.key.toLowerCase()){case"f":toggleFullscreen();break;case"r":s.click();break;case"s":l.checked=!l.checked,l.dispatchEvent(new Event("change"));break;case"w":d.checked=!d.checked,d.dispatchEvent(new Event("change"));break;default:if(Module._handle_keypress){var t=1===e.key.length?e.key.charCodeAt(0):e.keyCode;Module._handle_keypress(e.keyCode,t),console.log("Sending keypress: key='"+e.key+"', keyCode="+e.keyCode+", charCode="+t)}}}))}function setupFullscreenHandling(){document.getElementById("canvas");document.addEventListener("fullscreenchange",resizeCanvas),document.addEventListener("webkitfullscreenchange",resizeCanvas),document.addEventListener("mozfullscreenchange",resizeCanvas),document.addEventListener("MSFullscreenChange",resizeCanvas)}function resizeCanvas(){var e=document.getElementById("canvas");document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement?(e.width=window.screen.width,e.height=window.screen.height,Module._reshape_hextrail_wrapper&&Module._reshape_hextrail_wrapper(e.width,e.height)):(e.width=800,e.height=600,Module._reshape_hextrail_wrapper&&Module._reshape_hextrail_wrapper(e.width,e.height))}function toggleFullscreen(){var e=document.getElementById("canvas");document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen():e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()}function setupDebugPanelResizing(){var e=document.getElementById("debug-panel");if(e){var t=!1,n=0,o=0;e.addEventListener("mousedown",(function(l){l.offsetX<=8&&(t=!0,n=l.clientX,o=e.offsetWidth,l.preventDefault(),e.style.cursor="ew-resize",e.style.userSelect="none")})),document.addEventListener("mousemove",(function(l){if(t){var d=n-l.clientX,s=o+d;s=Math.max(200,Math.min(800,s)),e.style.width=s+"px",l.preventDefault()}})),document.addEventListener("mouseup",(function(){t&&(t=!1,e.style.cursor="",e.style.userSelect="",localStorage.setItem("debugPanelWidth",e.offsetWidth))}));var l=localStorage.getItem("debugPanelWidth");if(l){var d=parseInt(l);d>=200&&d<=800&&(e.style.width=d+"px")}}}window.enableMemoryMonitoring=enableMemoryMonitoring,document.getElementById("fullscreen").addEventListener("click",toggleFullscreen),document.addEventListener("DOMContentLoaded",(function(){setupDebugPanelResizing()}))</script><script async src=index.js></script></body></html>